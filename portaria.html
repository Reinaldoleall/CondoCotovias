<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portaria Pro - Sistema de Encomendas</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#2c3e50">
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    <script>
        // Inicializa o EmailJS com seu User ID
        (function() {
            emailjs.init("u4fUcSd9Yi3exmOiv"); // Substitua pelo seu User ID do EmailJS
        })();
    </script>

</head>
<body>
    <div id="loadingIndicator">
        <div class="preloader-wrapper big active">
            <div class="spinner-layer spinner-blue-only">
                <div class="circle-clipper left"><div class="circle"></div></div>
                <div class="gap-patch"><div class="circle"></div></div>
                <div class="circle-clipper right"><div class="circle"></div></div>
            </div>
        </div>
    </div>

    <header class="header-bar">
        <div class="header-welcome">
            <h5 id="welcomeMessage">Olá, <span id="userName">Porteiro</span>!</h5>
            <p>Bem-vindo ao Sistema de Encomendas</p>
        </div>
        <div class="header-actions">
            <button id="btnThemeToggle" class="btn-floating waves-effect waves-light" title="Alternar Tema">
                <i class="material-icons-round">dark_mode</i>
            </button>
            <button id="btnLogout" class="btn-floating waves-effect waves-light" title="Sair do Sistema">
                <i class="material-icons-round">exit_to_app</i>
            </button>
        </div>
    </header>

    <div class="container">
        <section class="stats-dashboard">
            <div class="stat-card tertiary">
                <div class="stat-label">Total Pendente</div>
                <div id="statPendente" class="stat-value">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Registradas Hoje</div>
                <div id="statRegistradasHoje" class="stat-value">0</div>
            </div>
            <div class="stat-card success">
                <div class="stat-label">Retiradas Hoje</div>
                <div id="statRetiradasHoje" class="stat-value">0</div>
            </div>
        </section>

        <div class="row">
            <div class="col s12 l5">
                <div class="card">
                    <div class="card-content">
                        <span class="card-title"><i class="material-icons-round">add_box</i> Registrar Encomenda</span>
                        <div class="row">
                            <div class="input-field col s6">
                                <i class="material-icons prefix">location_city</i>
                                <input id="blocoEncomenda" type="text" placeholder=" " required>
                                <label for="blocoEncomenda">Bloco</label>
                            </div>
                            <div class="input-field col s6">
                                <i class="material-icons prefix">meeting_room</i>
                                <input id="apartamentoEncomenda" type="text" placeholder=" " required>
                                <label for="apartamentoEncomenda">Apartamento</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <i class="material-icons prefix">inventory_2</i>
                                <input id="quantidadeEncomenda" type="number" class="validate" min="1" value="1" placeholder=" " required>
                                <label for="quantidadeEncomenda">Quantidade</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <i class="material-icons prefix">description</i>
                                <textarea id="descricaoEncomenda" class="materialize-textarea" placeholder=" "></textarea>
                                <label for="descricaoEncomenda">Descrição (opcional)</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col s12 center-align">
                                <button id="btnRegistrarEncomenda" class="btn waves-effect waves-light">Registrar
                                    <i class="material-icons-round right">send</i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col s12 l7">
                <div class="card">
                    <div class="card-content">
                        <span class="card-title"><i class="material-icons-round">local_shipping</i> Encomendas Pendentes</span>
                        <div class="input-field">
                            <i class="material-icons prefix">search</i>
                            <input type="text" id="searchInput" placeholder=" ">
                            <label for="searchInput">Buscar por bloco e apartamento (ex: A 101)</label>
                        </div>
                        <div id="searchResultsInfo"></div>
                        <ul class="collection" id="listaEncomendasPortaria">
                            </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modalEntrega" class="modal">
        <div class="modal-content">
            <h4>Registrar Entrega de Encomenda</h4>
            <p>Confirme os dados da pessoa que está retirando a encomenda. Uma notificação será enviada ao morador para confirmação final.</p>
            <div class="input-field">
                <i class="material-icons prefix">person</i>
                <input id="nomeRetirante" type="text" class="validate" required placeholder=" ">
                <label for="nomeRetirante">Nome de quem está retirando</label>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect btn-flat">Cancelar</a>
            <button class="waves-effect waves-light btn" id="btnConfirmarEntrega">Confirmar Retirada</button>
        </div>
    </div>

    <div id="modalDetalhes" class="modal">
        <div class="modal-content">
            <h4>Detalhes da Encomenda</h4>
            <div class="row">
                <div class="col s12 m6">
                    <p><strong><i class="material-icons-round tiny">apartment</i> Bloco/Apto:</strong> <span id="detalhesBlocoApto"></span></p>
                    <p><strong><i class="material-icons-round tiny">event</i> Data/Hora:</strong> <span id="detalhesData"></span></p>
                    <p><strong><i class="material-icons-round tiny">person_pin</i> Registrado por:</strong> <span id="detalhesPorteiro"></span></p>
                </div>
                <div class="col s12 m6">
                    <p><strong><i class="material-icons-round tiny">inventory</i> Quantidade:</strong> <span id="detalhesQuantidade"></span></p>
                    <p><strong><i class="material-icons-round tiny">bookmark</i> Status:</strong> <span id="detalhesStatus" class="badge"></span></p>
                    <p><strong><i class="material-icons-round tiny">notes</i> Descrição:</strong> <span id="detalhesDescricao"></span></p>
                </div>
            </div>
            <div class="row hide" id="detalhesRetiradaSection">
                <div class="col s12">
                    <hr style="border-top: 1px solid var(--md-sys-color-outline); margin: 16px 0;">
                    <p><strong><i class="material-icons-round tiny">how_to_reg</i> Retirado por:</strong> <span id="detalhesRetiradoPor"></span></p>
                    <p><strong><i class="material-icons-round tiny">update</i> Data da Retirada:</strong> <span id="detalhesDataRetirada"></span></p>
                </div>
            </div>
             <div class="row" id="detalhesLogSection">
                <div class="col s12">
                    <h6 style="font-weight: 500; margin-top: 20px;">Histórico de Eventos</h6>
                    <ul id="detalhes-log-list" class="collection" style="border-color: var(--md-sys-color-surface-variant);">
                        </ul>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect btn-flat">Fechar</a>
            <button class="waves-effect waves-light btn hide" id="btnEntregarDetalhes">Registrar Entrega</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src= "js/portaria.js"></script>
</body>
</html>
